<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
    <head>
        <meta charset="utf-8">

        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta name="description" content="It&#39;s a good idea to install JCE.">
        <meta name="keywords" content="PingFederate, Cryptography, ">

         
        <meta property="og:type" content="article"/>
        <meta property="og:description" content="It&#39;s a good idea to install JCE."/>
        <meta property="og:title" content="PingFederate 8 and the JCE : woolnough.com.au"/>
        <meta property="og:site_name" content="Site by Matthew Woolnough"/>
        <meta property="og:image" content="" />
        <meta property="og:image:type" content="image/jpeg" />
        <meta property="og:image:width" content="" />
        <meta property="og:image:height" content="" />
        <meta property="og:url" content="http://woolnough.com.au/blog/pingfederate-8-and-the-jce/">
        <meta property="og:locale" content="en_US">
        <meta property="article:published_time" content="2015-10-10"/>
        <meta property="article:modified_time" content="2015-10-10"/>


        
        <meta property="article:tag" content="PingFederate">
        <meta property="article:tag" content="Cryptography">
        
        

        
        <meta name="twitter:card" content="summary">
        
        <meta name="twitter:site" content="@mattwoolnough">
        <meta name="twitter:title" content="PingFederate 8 and the JCE : woolnough.com.au">
        <meta name="twitter:creator" content="@mattwoolnough">
        <meta name="twitter:description" content="It&#39;s a good idea to install JCE.">
        <meta name="twitter:image:src" content="">
        <meta name="twitter:domain" content="woolnough.com.au">



        <base href="/">
        <title> PingFederate 8 and the JCE - woolnough.com.au </title>
        <link rel="canonical" href="http://woolnough.com.au/blog/pingfederate-8-and-the-jce/">
        

        <link href='http://fonts.googleapis.com/css?family=Fjalla+One|Open+Sans:300' rel='stylesheet' type='text/css' />
        <link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="/css/prism.css" />
        <link rel="stylesheet" href="/css/tables.css" />
        <link type="text/css" rel="stylesheet" href="/css/search.css" media="all" />

        
        <link rel="shortcut icon" type="image/png" href="/favicon.png"/>
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    </head>

<body lang="en" itemscope itemtype="http://schema.org/Article">
<header id="header">
    <figure>
        <a href="/" border=0 id="logolink">
            <img src="/media/wolf_circ_smlish.png" id="logo">
        </img></a>
    </figure>
    <div id="byline">by Matthew Woolnough</div>
    <nav id="nav">
            <ul id="mainnav">
            <li>
                <a href="/blog/">
                <span class="icon"> <i aria-hidden="true" class="icon-quill"></i></span>
                <span> blog </span>
            </a>
            </li>
            <li>
            <a href="/code/">
                <span class="icon"> <i aria-hidden="true" class="icon-console"></i></span>
                <span> code </span>
            </a>
            </li>
            <li>
            <a>
                <span class="icon"> <i aria-hidden="true" class="icon-search"></i></span>
                <span> search </span>
            </a>
            </li>
            <li>
            <a href="/about">
                <span class="icon"> <i aria-hidden="true" class="icon-info"></i></span>
                <span> about </span>
            </a>
            </li>
        </ul>
        <input type="text" id="search-input" class="st-default-search-input"  style="display:none;" >
            <ul id="social">
            <li id="share">
                <span class="icon icon-bubbles"> </span>
                <span class="title"> share </span>
                <div class="dropdown share">
                    <ul class="social">
                      <li> <a href="https://twitter.com/intent/tweet?status=PingFederate%208%20and%20the%20JCE-http%3a%2f%2fwoolnough.com.au%2fblog%2fpingfederate-8-and-the-jce%2f" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                        <li> <a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fwoolnough.com.au%2fblog%2fpingfederate-8-and-the-jce%2f" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                        <li> <a href="https://plus.google.com/share?url=http%3a%2f%2fwoolnough.com.au%2fblog%2fpingfederate-8-and-the-jce%2f" target="_blank" title="Google+" class="googleplus"><span class="icon icon-google-plus"></span>Google+</a> </li>
                        <li> <a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fwoolnough.com.au%2fblog%2fpingfederate-8-and-the-jce%2f" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                        <li> <a href="http://del.icio.us/post?url=http%3a%2f%2fwoolnough.com.au%2fblog%2fpingfederate-8-and-the-jce%2f" target="_blank" title="Delicious" class="delicious"><span class="icon icon-delicious"></span>Delicious</a> </li>
                        <li> <a href="http://www.reddit.com/submit?url=http%3a%2f%2fwoolnough.com.au%2fblog%2fpingfederate-8-and-the-jce%2f" target="_blank" title="Reddit" class="reddit"><span class="icon icon-reddit"></span>Reddit</a> </li>
                        <li> <a href="http://www.stumbleupon.com/submit?url=http%3a%2f%2fwoolnough.com.au%2fblog%2fpingfederate-8-and-the-jce%2f" target="_blank" title="StumbleUpon" class="stumbleupon"><span class="icon icon-stumbleupon"></span>StumbleUpon</a> </li>
                    </ul>
                    <span class="subcount">sharing is caring</span>
                </div>
            </li>
            <li id="follow">
                <span class="icon icon-rocket"> </span>
                <span class="title"> follow </span>
                <div class="dropdown follow">
                    <ul class="social">
                        <li> <a href="https://www.twitter.com/mattwoolnough" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                        <li> <a href="https://www.facebook.com/mattwoolnough" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                        <li> <a href="https://au.linkedin.com/pub/matthew-woolnough/6/10a/45" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                        <li> <a href="http://github.com/mattwoolnough" target="_blank" title="GitHub" class="github"><span class="icon icon-github"></span>GitHub</a> </li>
                    </ul>
                    <span class="subcount">join 10+ subscribers &amp; followers</span>
                </div>
            </li>
        </ul>

    </nav>
</header>



<section id="main">
  <h1 itemprop="name" id="title">PingFederate 8 and the JCE</h1>
  <div>
        <article itemprop="articleBody" id="content">
           

<p>TL;DR It&rsquo;s a good idea to install JCE.</p>

<p>Installing the Java Cryptography Extension <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html">JCE</a> is highly recommended if your countries laws permit it&rsquo;s importation and use, for two reasons: adherence with standards &amp; interoperability.
There&rsquo;s some pretty cool <a href="http://hueniverse.com/2015/09/19/auth-to-see-the-wizard-or-i-wrote-an-oauth-replacement/">stuff</a> being developed by those who don&rsquo;t care too much for interoperability, but for those of us in the Enterprise Identity Management space, it&rsquo;s essential.</p>

<p>Java 8 gives you basic crypto, but includes limits on <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/SunProviders.html">Maximum Keysizes</a>. The following table provides a quick summary.</p>

<table>
<thead>
<tr>
<th>Algorithm</th>
<th>Maximum Keysize</th>
</tr>
</thead>

<tbody>
<tr>
<td>DES</td>
<td>64</td>
</tr>

<tr>
<td>DESede (AKA TripleDES)</td>
<td>*</td>
</tr>

<tr>
<td>RC2</td>
<td>128</td>
</tr>

<tr>
<td>RC4</td>
<td>128</td>
</tr>

<tr>
<td>RC5</td>
<td>128</td>
</tr>

<tr>
<td>RSA</td>
<td>*</td>
</tr>

<tr>
<td>All others (inc. AES)</td>
<td>128</td>
</tr>
</tbody>
</table>

<p>What does this mean for us?</p>

<h3 id="tls:e3af48ef36a0841a3da62d6f5a278b14">TLS</h3>

<p>Fewer Crypto options.
I don&rsquo;t see this is a huge issue. When we deploy a PingFederate cluster, it&rsquo;s typically behind a TLS Terminating Load Balancer anyway, which means that our TLS Sessions only exist in the data centre and we&rsquo;re generally pretty happy with <strong>AES128</strong> for TLS.</p>

<h3 id="saml-ws:e3af48ef36a0841a3da62d6f5a278b14">SAML/WS-*</h3>

<p>No <strong>TripleDES</strong> or <strong>AES256</strong> XML block encryption option</p>

<ul>
<li>Not compliant with the <a href="http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/Overview.html">W3C XML Encryption Recommendation</a> (yes, only a recommendation) which is used by SAML &amp; WS-* Protocols. This states that AES256 &amp; TripleDES are &lsquo;required&rsquo;.</li>
<li>Assertions in the responses are in the clear on the above mentioned Load Balancer (and many other similar scenarios) without this.  This may be an issue if the assertions contain sensitive information.</li>
<li>We can&rsquo;t be an Relying Party (RP) to an ADFS 2.x (and newer) Identity Provider (IP) without disabling the encryption of claims. <code>set-ADFSRelyingPartyTrust –TargetName &quot;Ping RP&quot; –EncryptClaims $False</code>. It does not appear to be possible to downgrade ADFS to use AES128.</li>
</ul>

<h3 id="openid-connect:e3af48ef36a0841a3da62d6f5a278b14">OpenID Connect</h3>

<p>The upcoming Javascript Object Signing and Encryption (JOSE) standard include a specification on <a href="http://tools.ietf.org/html/draft-ietf-jose-json-web-algorithms-40#section-4.1">JWE key management</a> and <a href="http://tools.ietf.org/html/draft-ietf-jose-json-web-algorithms-40#section-5.1">JWE content encryption</a>.
The table below shows the encryption and key management options with and without the JCE installed. Many of the additional options enabled by installing the JCE are either optional or recommended in the listed specifications.</p>

<table>
<thead>
<tr>
<th>Config</th>
<th>JWE content encryption algorithms</th>
<th>JWE key management algorithms</th>
</tr>
</thead>

<tbody>
<tr>
<td>Without JCE</td>
<td>A128CBC-HS256, A128GCM</td>
<td>RSA1_5, RSA-OAEP, RSA-OAEP-256, dir, A128KW, ECDH-ES, ECDH-ES+A128KW, PBES2-HS256+A128KW, A128GCMKW</td>
</tr>

<tr>
<td>With JCE</td>
<td>A128CBC-HS256, A192CBC-HS384, A256CBC-HS512, A128GCM, A192GCM, A256GCM</td>
<td>RSA1_5, RSA-OAEP, RSA-OAEP-256, dir, A128KW, A192KW, A256KW, ECDH-ES, ECDH-ES+A128KW, ECDH-ES+A192KW, ECDH-ES+A256KW, PBES2-HS256+A128KW, PBES2-HS384+A192KW, PBES2-HS512+A256KW, A128GCMKW, A192GCMKW, A256GCMKW</td>
</tr>
</tbody>
</table>

<h2 id="installation:e3af48ef36a0841a3da62d6f5a278b14">Installation</h2>

<ol>
<li>Ensure your JAVA_HOME is directed at your JRE, not the JDK.</li>
<li>Download the <a href="[JCE](http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html">Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files 8</a></li>
<li>Extract the files to JAVA_HOME\lib\security</li>
<li>If you&rsquo;re on a Windows OS, right click each policy file individually and unblock.</li>
<li>Edit the following file and enable the ciphers you wish to use.
<code>&lt;installDir&gt;\pingfederate\server\default\data\config-store\com.pingidentity.crypto.SunJCEManager.xml</code><br />
Note: If you want to be super cautious, disable <strong>TLS_DHE_RSA_WITH_AES_256_CBC_SHA256</strong> and <strong>TLS_DHE_RSA_WITH_AES_256_CBC_SHA</strong> as these are potentially susceptible to Logjam vulnerability. The Logjam test site reports that an uncommon 1024 bit group is used so it should be ok, but why risk it!?</li>
<li>Restart the service</li>
</ol>

<p>If everything went successfully you should see messages in server.log resembling:</p>

<p><code>org.jose4j.jwe.AesKeyWrapManagementAlgorithm$Aes256@7244d076 registered for alg algorithm A256KW</code></p>

<p>instead of:</p>

<p><code>A256KW is unavailable so will not be registered for alg algorithms.</code></p>

<p>If you happen to notice the messages in the logs at startup stating that <strong>PS256</strong>, <strong>PS384</strong> &amp; <strong>PS512</strong> are unavailable, it&rsquo;s safe to ignore these. They are unavoidable at the time of writing, as they require bouncy castle which is <em>not supported</em> by PingFederate.</p>

<p>Full log samples here:</p>

<p><a href="https://gist.githubusercontent.com/mattwoolnough/5e77731b1696730137b0/raw/3146e8d74bb486ef4e0cb715942b09a2cc0966b1/server.log">PingFederate Logs without JCE</a></p>

<p><a href="https://gist.githubusercontent.com/mattwoolnough/432f514e357aebcd7ccd/raw/bedf2a8af662d999df453edba931c3a031d679d0/server.log">PingFederate Logs with JCE</a></p>

        </article>
  </div>
</section>



        <aside id="meta">
        

    <div>
        <section id="datecount">
          <h4 id="date"> Sat Oct 10, 2015 </h4>
          <h5 id="wc"> 600 Words </h5>
          <h5 id="readtime"> Read in about 3 Min </h5>
        </section>

        <ul id="categories">
          
        </ul>
        <ul id="tags">
          
            <li> <a href="http://woolnough.com.au/tags/pingfederate">PingFederate</a> </li>
          
            <li> <a href="http://woolnough.com.au/tags/cryptography">Cryptography</a> </li>
          
        </ul>
    </div>

    <div>
        <section id="prev">
            &nbsp;<a class="previous" href="http://woolnough.com.au/blog/http-redirect-disallowed-for-transport-of-sso-response/"><i class="icon-arrow-left"></i> HTTP-Redirect disallowed for transport of SSO response</a><br>
        </section><section id="next">
            &nbsp;<a class="next" href="http://woolnough.com.au/blog/creating-a-new-publish-settings-file-from-azure-portal/">Creating a new publish settings file from azure portal <i class="icon-arrow-right"></i></a>
        </section>
    </div>


        </aside>

        <meta itemprop="wordCount" content="582">
        <meta itemprop="datePublished" content="2015-10-10">
        <meta itemprop="url" content="http://woolnough.com.au/blog/pingfederate-8-and-the-jce/">



    <aside id=comments>
        <section class="post-comments">
            <a class="muut" href="https://muut.com/i/Woolnough/comments:PingFederate%208%20and%20the%20JCE">Comments</a>
            <script src="//cdn.muut.com/1/moot.min.js"></script>
        </section>
    </aside>

    <footer>
      <div>
        <p>
        &copy; 2015 <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span itemprop="name">Matthew Woolnough.</span></span>
        <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons Attribution">Some rights reserved</a>;
        please attribute properly and link back. <br>
          Powered by<a href="http://gohugo.io">Hugo</a>. Based on<a href="https://github.com/spf13/spf13.com">spf13</a>.
          Super awesome commenting by <a href="http://muut.com">Muut</a>.
             Logo image sourced from<a href="http://www.freepik.com/free-photos-vectors/design">Freepik</a>. Disclaimer: The opinions expressed herein are my own personal opinions and do not represent my employer's view in any way.
        </p>
      </div>
    </footer>


    <script async type="text/javascript" src="/js/prism.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script async type='text/javascript' src='/js/jquery.ba-hashchange.min.js'></script>
    <script type="text/javascript" src="/js/jquery.swiftype.search.js"></script>
    <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
            (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

      _st('install','ngtrsw8NsQZucSyqhWp7','2.0.0');
    </script>

    <script type="text/javascript">
      $('#st-search-input').swiftypeSearch({
        resultContainingElement: '#st-results-container',
        engineKey: 'nV1GVnGX2VkcQBNN7FYy'
      });
    </script>

    <script type="text/javascript">
      $(".icon-search").click(function(){
        $(".st-default-search-input").toggle();
      });
    </script>


    <script type="text/javascript">
    (function(){var j=function(a,b){return window.getComputedStyle?getComputedStyle(a).getPropertyValue(b):a.currentStyle[b]};var k=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else a.attachEvent('on'+b,c)};var l=function(a,b){for(key in b)if(b.hasOwnProperty(key))a[key]=b[key];return a};window.fitText=function(d,e,f){var g=l({'minFontSize':-1/0,'maxFontSize':1/0},f);var h=function(a){var b=e||1;var c=function(){a.style.fontSize=Math.max(Math.min(a.clientWidth/(b*10),parseFloat(g.maxFontSize)),parseFloat(g.minFontSize))+'px'};c();k(window,'resize',c)};if(d.length)for(var i=0;i<d.length;i++)h(d[i]);else h(d);return d}})();
    fitText(document.getElementById('title'), 1)
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-66187909-4', 'auto');
      ga('send', 'pageview');
    </script>

    
    <script>
      $( document ).ready(function() {
        function hidePanel() {
          $('#moot-logo').attr ("style", "display: none !important");
        }
        setTimeout(hidePanel, 4000)
      });
    </script>

  </body>
</html>

